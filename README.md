# search_files_delete_audit
Searching for deleted files through the Event Log

* Этот скрипт представляет собой инструмент для анализа журнала событий в операционной системе Windows с целью поиска пользователя который удалил файл. 
* Он позволяет пользователю указать диапазон дат и имя файла для поиска. 
* После выполнения поиска скрипт выводит результаты в виде таблицы, содержащей информацию о времени события удаления файла, имени файла, пользователе, совершившем действие, и имени компьютера, на котором произошло событие. 
* Этот инструмент может быть полезен для отслеживания удаленных файлов и выявления подозрительной активности в системе.
* На текущий момент скрипт ищет Код события 4663 без учета Кода событий 4660
* Соответственно если файл был переименован событие так же отобразиться в логе как Код событий 4663
* В будущем добавить проверку на появление Кода событий 4660 после 4663 и исключить вывод файлов которые были переименованы, а не удалены
* Для того, что бы скрипт работал надо
*
* 1.1. Включить аудит в групповой политике:
    gpedit.msc →
    Конфигурация компьютера → Политики → Конфигурация Windows → Параметры безопасности → Локальные политики → Аудит доступа к объектам
    ✅ Включить: Успешные и неудачные попытки
  1.2. Включить аудит удаления на папке:
На нужной папке:
    Свойства → Безопасность → Дополнительно → Аудит
    Добавить: Все действия для Удалить (Delete) и Удалить подчиненные (Delete Subfolders and Files)
    ✅ Убедиться, что включен аудит на Это папка, подпапки и файлы

## Requirements
 * Powershell 2.0

## Version History
```
17.06.2025
- исправлена работа Поиска удалённых файлов по событиям 4660 и 4663, теперь поиск учитывает точное удление, а не зпрос на удаление. Сопоставление по HandleId
- Проверка AccessMask на признак удаления (0x10000)
- Поддержка поиска по имени файла и диапазону дат
- Добаавлен Прогресс-бар на случай долгой загрузки
- Более надёжная фильтрация .tmp, ~$, и ~lock.filename# файлов.
- Оптимизация и быстродействия скрипт

29.03.2024
- Добавлена проверка на корректное указание даты
- Обновление Данных: Для избежания повторной загрузки и отображения данных, перед выполнением нового поиска происходит очистка таблицы.

27.03.2024 
- Оптимизирован Код, Убран Дублирующий Код
- Часть кода перенесена в функцию
- Добавлена обработка исключений в скрипт, для корректной обработки ошибок.

25.03.2025 -  Исправлена фильтрация временных файлов
```
